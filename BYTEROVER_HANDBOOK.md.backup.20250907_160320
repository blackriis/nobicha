# Byterover Handbook - Employee Management System

## Layer 1: System Overview 🎯

### Purpose
Employee Management System (ระบบบริหารจัดการพนักงาน) - A comprehensive fullstack Thai employee management application with GPS-based check-in/out functionality, branch management, and payroll processing.

### Architecture Pattern
**Serverless Monorepo Architecture** with Next.js App Router
- **Primary Pattern**: Feature-based modular architecture with service layer abstraction
- **Secondary Pattern**: Component-driven UI with Supabase backend integration
- **Deployment**: Vercel serverless platform

### Tech Stack Core
```typescript
Frontend: Next.js 15.5 + TypeScript 5 + React 19
UI: Shadcn UI + Tailwind CSS 4 + Radix UI
State: Zustand 5.0 (for complex state management)
Backend: Next.js API Routes (serverless)
Database: Supabase PostgreSQL + Auth + Storage
Testing: Vitest + RTL + Playwright E2E
Validation: Zod 4.1 + React Hook Form 7.62
```

### Key Technical Decisions
- **Monorepo Structure**: npm workspaces for code sharing
- **Service Layer Pattern**: Abstract API calls from components
- **Feature-based Organization**: Modular component structure
- **Role-based Authentication**: Admin/Employee access control
- **GPS Integration**: HTML5 Geolocation + Haversine calculations

## Layer 2: Module Map 📁

### Core Business Modules
```
🏢 Branch Management
├── Location: apps/web/src/components/admin/
├── Purpose: GPS-based branch creation and management
└── Key Files: BranchList.tsx, BranchForm.tsx, WorkShiftForm.tsx

👤 User Authentication & Roles
├── Location: apps/web/src/components/auth/
├── Purpose: Supabase-based auth with admin/employee roles
└── Key Files: AuthProvider.tsx, LoginForm.tsx, ProtectedRoute.tsx

⏰ Time Tracking (Future)
├── Location: apps/web/src/features/ (to be created)
├── Purpose: GPS-validated check-in/out with selfie verification
└── Dependencies: Branch Management, Location Services

💰 Payroll Management (Future)
├── Location: apps/web/src/features/ (to be created)
├── Purpose: Automated payroll calculation and reporting
└── Dependencies: Time Tracking, User Management
```

### Technical Infrastructure
```
🔧 Services Layer
├── Location: apps/web/src/lib/services/
├── Purpose: API abstraction and business logic
└── Current: user.service.ts, index.ts

🛠 Utilities & Config
├── Location: apps/web/src/lib/
├── Purpose: Shared utilities, validation, auth helpers
└── Key Files: supabase.ts, auth.ts, validation.ts, utils.ts

📦 Shared Packages
├── Location: packages/
├── Purpose: Cross-app shared code (types, UI, config)
└── Packages: @employee-management/{database,ui,config}
```

### Data Layer
```
🗄 Database Schema (Supabase)
├── Core Tables: branches, users, work_shifts
├── Future Tables: time_entries, payroll_cycles, sales_reports
└── Migrations: database/migrations/*.sql
```

## Layer 3: Integration Guide 🔗

### API Architecture
**Base Path**: `/api/`
**Pattern**: RESTful endpoints with role-based access

```typescript
// Admin Endpoints (Protected)
GET    /api/admin/branches          // List all branches
POST   /api/admin/branches          // Create branch
PUT    /api/admin/branches/[id]     // Update branch
DELETE /api/admin/branches/[id]     // Delete branch

GET    /api/admin/branches/[id]/shifts // List shifts for branch
POST   /api/admin/branches/[id]/shifts // Create shift
PUT    /api/admin/shifts/[id]          // Update shift
DELETE /api/admin/shifts/[id]          // Delete shift

// Employee Endpoints
GET    /api/employee/available-branches // GPS-filtered branches

// Location Services
POST   /api/location/nearby-branches    // Find branches within 100m radius
```

### Authentication Flow
```typescript
// Middleware: apps/web/src/middleware.ts
// Auth Provider: apps/web/src/components/auth/AuthProvider.tsx
// Routes:
//   - /login/admin     -> Admin login
//   - /login/employee  -> Employee login
//   - /admin/*         -> Admin dashboard (protected)
//   - /dashboard/*     -> Employee dashboard (protected)
```

### Configuration Management
```typescript
// Environment Variables (via packages/config)
SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY

// Database Types (via packages/database)
import { User, Branch, WorkShift } from '@employee-management/database'

// Shared UI Components (via packages/ui)
import { Button, Form, Input } from '@employee-management/ui'
```

### GPS Integration Specifications
```typescript
// Location Services: apps/web/src/lib/utils/gps.utils.ts
- HTML5 Geolocation API for user location
- Haversine formula for distance calculations
- 100-meter radius validation for check-ins
- Error handling for GPS disabled/unavailable
- Permission request management
```

## Layer 4: Extension Points 🔧

### Design Patterns in Use
```typescript
🎯 Service Layer Pattern
├── Abstract API calls from components
├── Centralize business logic
└── Example: apps/web/src/lib/services/user.service.ts

🛡 Protected Route Pattern
├── Role-based access control
├── Authentication middleware
└── Example: apps/web/src/components/auth/ProtectedRoute.tsx

📱 Feature-based Architecture
├── Organize code by business features
├── Encapsulate related functionality
└── Structure: apps/web/src/features/[feature]/
```

### Customization Areas
```typescript
🎨 UI Theme & Localization
├── Modify: apps/web/src/app/globals.css
├── Extend: Tailwind config for Thai-specific styling
└── Localize: All text content in Thai language

🗄 Database Schema Extensions
├── Add tables: database/migrations/
├── Extend types: packages/database/types.ts
└── Update services: apps/web/src/lib/services/

📍 GPS & Location Features
├── Customize radius: 100m default (configurable)
├── Add map integration: Optional GPS picker component
└── Extend location validation: Custom business rules
```

### Development Workflow Extensions
```typescript
🧪 Testing Patterns
├── Unit Tests: apps/web/src/__tests__/
├── API Tests: Integration testing for endpoints
├── E2E Tests: Playwright for user workflows
└── GPS Mocking: Test location-based features

🚀 Deployment Extensions
├── Vercel Platform: Serverless deployment
├── Environment Management: Development/Production configs
└── Database Migrations: Automated via Supabase CLI
```

### Future Story Integration Points
```typescript
📸 Selfie Verification (Story 1.4)
├── Extend: time_entries table with photo URLs
├── Add: Camera capture components
└── Integrate: Supabase Storage for photos

📊 Material Tracking (Story 2.x)
├── Add: material_usage, raw_materials tables
├── Create: Inventory management features
└── Link: Branch-specific material tracking

💸 Sales Reporting (Story 2.x)
├── Add: sales_reports table
├── Create: Daily sales entry forms  
└── Generate: Branch/employee sales analytics
```

---

**Generated**: 2025-09-07 | **Project**: Employee Management System | **Version**: 1.0  
**Context**: Story 1.3 Branch Management & GPS Configuration Implementation

*This handbook serves as the primary navigation guide for AI agents and human developers working on the Employee Management System codebase.*