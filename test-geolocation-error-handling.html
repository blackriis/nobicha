<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Geolocation Error Handling</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .error-button {
            background: #dc3545;
        }
        .error-button:hover {
            background: #c82333;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .warning {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Geolocation Error Handling</h1>
    <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏Ç‡∏≠‡∏á Geolocation API</p>

    <div class="test-section">
        <h2>1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</h2>
        <button class="test-button" onclick="testNormalGeolocation()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö GPS ‡∏õ‡∏Å‡∏ï‡∏¥</button>
        <div id="normal-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Permission Denied</h2>
        <button class="test-button error-button" onclick="testPermissionDenied()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Permission Denied</button>
        <div id="permission-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Position Unavailable</h2>
        <button class="test-button error-button" onclick="testPositionUnavailable()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Position Unavailable</button>
        <div id="position-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Timeout</h2>
        <button class="test-button error-button" onclick="testTimeout()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Timeout</button>
        <div id="timeout-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>5. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Empty Object Error</h2>
        <button class="test-button error-button" onclick="testEmptyObjectError()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Empty Object Error</button>
        <div id="empty-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>6. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö CoreLocation Error (iOS/macOS)</h2>
        <button class="test-button error-button" onclick="testCoreLocationError()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö CoreLocation Error</button>
        <div id="corelocation-result" class="log"></div>
    </div>

    <div class="test-section">
        <h2>7. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Error Handling Function</h2>
        <button class="test-button" onclick="testErrorHandlingFunction()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Error Handling Function</button>
        <div id="handling-result" class="log"></div>
    </div>

    <script>
        // Enhanced error logging function (copied from CheckInOutCard.tsx)
        function logGeolocationError(error, context = '') {
            console.error(`üî• Geolocation error ${context} - Raw error:`, error);
            console.error(`üî• Geolocation error type:`, typeof error);
            console.error(`üî• Geolocation error constructor:`, error?.constructor?.name);
            
            // Check if error is an empty object or has no useful properties
            if (error && typeof error === 'object') {
                const errorKeys = Object.keys(error);
                console.error(`üî• Geolocation error keys:`, errorKeys);
                console.error(`üî• Geolocation error values:`, Object.values(error));
                
                if (errorKeys.length === 0) {
                    console.error(`üî• Geolocation error is empty object - this might be a serialization issue`);
                    return {
                        isEmpty: true,
                        message: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï GPS'
                    };
                }
            }
            
            if (error && typeof error === 'object' && 'code' in error) {
                // Handle GeolocationPositionError
                const geoError = error;
                const errorInfo = {
                    errorType: 'GeolocationPositionError',
                    code: geoError.code,
                    message: geoError.message || 'No message provided',
                    codeNames: {
                        1: 'PERMISSION_DENIED',
                        2: 'POSITION_UNAVAILABLE', 
                        3: 'TIMEOUT'
                    },
                    currentCodeName: geoError.code === 1 ? 'PERMISSION_DENIED' : 
                                    geoError.code === 2 ? 'POSITION_UNAVAILABLE' : 
                                    geoError.code === 3 ? 'TIMEOUT' : 'UNKNOWN'
                };
                
                console.error(`üî• Geolocation error details:`, errorInfo);
                
                let errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ';
                switch (geoError.code) {
                    case 1: // PERMISSION_DENIED
                        errorMessage = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå';
                        break;
                    case 2: // POSITION_UNAVAILABLE
                        errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS';
                        break;
                    case 3: // TIMEOUT
                        errorMessage = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                        break;
                    default:
                        errorMessage = `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${geoError.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}`;
                }
                
                return {
                    isGeolocationError: true,
                    code: geoError.code,
                    message: errorMessage,
                    details: errorInfo
                };
            } else if (error instanceof Error) {
                const errorInfo = {
                    errorType: 'Error',
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                };
                console.error(`üî• General error:`, errorInfo);
                return {
                    isError: true,
                    message: error.message,
                    details: errorInfo
                };
            } else {
                // Handle non-Error objects more carefully
                const errorInfo = {
                    errorType: typeof error,
                    errorValue: error,
                    errorString: String(error),
                    errorJSON: (() => {
                        try {
                            return JSON.stringify(error, null, 2);
                        } catch (e) {
                            return 'Cannot stringify error object';
                        }
                    })(),
                    hasCode: 'code' in (error || {}),
                    hasMessage: 'message' in (error || {}),
                    keys: error && typeof error === 'object' ? Object.keys(error) : []
                };
                console.error(`üî• Unknown error:`, errorInfo);
                return {
                    isUnknown: true,
                    message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏',
                    details: errorInfo
                };
            }
        }

        // Test functions
        function testNormalGeolocation() {
            const resultDiv = document.getElementById('normal-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            
            if (!navigator.geolocation) {
                resultDiv.innerHTML = '<span class="error">‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Geolocation API</span>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    resultDiv.innerHTML = `<span class="success">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${position.coords.latitude}, ${position.coords.longitude}
‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥: ${position.coords.accuracy} ‡πÄ‡∏°‡∏ï‡∏£`;
                },
                (error) => {
                    const errorResult = logGeolocationError(error, 'in normal test');
                    resultDiv.innerHTML = `<span class="error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</span>
${JSON.stringify(errorResult, null, 2)}`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 60000
                }
            );
        }

        function testPermissionDenied() {
            const resultDiv = document.getElementById('permission-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Permission Denied...';
            
            // Simulate permission denied error
            const mockError = {
                code: 1,
                message: 'User denied the request for Geolocation.'
            };
            
            const errorResult = logGeolocationError(mockError, 'permission denied test');
            resultDiv.innerHTML = `<span class="warning">‚ö†Ô∏è Permission Denied Test:</span>
${JSON.stringify(errorResult, null, 2)}`;
        }

        function testPositionUnavailable() {
            const resultDiv = document.getElementById('position-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Position Unavailable...';
            
            // Simulate position unavailable error
            const mockError = {
                code: 2,
                message: 'Location information is unavailable.'
            };
            
            const errorResult = logGeolocationError(mockError, 'position unavailable test');
            resultDiv.innerHTML = `<span class="warning">‚ö†Ô∏è Position Unavailable Test:</span>
${JSON.stringify(errorResult, null, 2)}`;
        }

        function testTimeout() {
            const resultDiv = document.getElementById('timeout-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Timeout...';
            
            // Simulate timeout error
            const mockError = {
                code: 3,
                message: 'The request to get user location timed out.'
            };
            
            const errorResult = logGeolocationError(mockError, 'timeout test');
            resultDiv.innerHTML = `<span class="warning">‚ö†Ô∏è Timeout Test:</span>
${JSON.stringify(errorResult, null, 2)}`;
        }

        function testEmptyObjectError() {
            const resultDiv = document.getElementById('empty-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Empty Object Error...';
            
            // Simulate empty object error (the problematic case from the real error)
            const mockError = {};
            
            console.log('üß™ Testing empty object error (the real issue):');
            console.log('Raw error:', mockError);
            console.log('Type:', typeof mockError);
            console.log('Keys:', Object.keys(mockError));
            console.log('Values:', Object.values(mockError));
            
            const errorResult = logGeolocationError(mockError, 'empty object test');
            resultDiv.innerHTML = `<span class="error">‚ùå Empty Object Test (Real Issue):</span>
<pre>${JSON.stringify(errorResult, null, 2)}</pre>
<div class="warning">
<strong>üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ - error object ‡πÄ‡∏õ‡πá‡∏ô empty object {}
</div>`;
        }

        function testCoreLocationError() {
            const resultDiv = document.getElementById('corelocation-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö CoreLocation Error...';
            
            // Simulate CoreLocation error scenarios
            const coreLocationErrors = [
                { 
                    name: 'kCLErrorLocationUnknown', 
                    error: { code: 2, message: 'CoreLocation framework reported a kCLErrorLocationUnknown failure.' },
                    description: 'CoreLocation ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ'
                },
                { 
                    name: 'Invalid Position Data', 
                    error: new Error('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'),
                    description: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
                },
                { 
                    name: 'Zero Coordinates', 
                    error: new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPS'),
                    description: '‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î 0,0 (‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)'
                },
                { 
                    name: 'High Inaccuracy', 
                    error: { code: 2, message: 'Position accuracy too low' },
                    description: '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (accuracy > 1000m)'
                }
            ];
            
            let results = 'üß™ CoreLocation Error Test Results:\n\n';
            
            coreLocationErrors.forEach((test, index) => {
                results += `${index + 1}. ${test.name}:\n`;
                results += `   Description: ${test.description}\n`;
                const errorResult = logGeolocationError(test.error, `CoreLocation test ${index + 1}`);
                results += `   Result: ${JSON.stringify(errorResult, null, 2)}\n\n`;
            });
            
            // Test real geolocation with enhanced options
            results += 'üåç Real Geolocation Test with Enhanced Options:\n';
            results += 'Testing with timeout: 15000ms, maximumAge: 30000ms\n\n';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude, accuracy } = position.coords;
                        results += `‚úÖ Success!\n`;
                        results += `   Latitude: ${latitude}\n`;
                        results += `   Longitude: ${longitude}\n`;
                        results += `   Accuracy: ${accuracy} meters\n`;
                        
                        if (accuracy > 1000) {
                            results += `   ‚ö†Ô∏è Warning: Low accuracy detected\n`;
                        }
                        
                        resultDiv.innerHTML = `<span class="success">‚úÖ CoreLocation Test Complete:</span>
<pre>${results}</pre>`;
                    },
                    (error) => {
                        results += `‚ùå Real Geolocation Error:\n`;
                        const errorResult = logGeolocationError(error, 'real geolocation test');
                        results += `   ${JSON.stringify(errorResult, null, 2)}\n`;
                        
                        resultDiv.innerHTML = `<span class="error">‚ùå CoreLocation Test with Real Error:</span>
<pre>${results}</pre>`;
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 15000,
                        maximumAge: 30000
                    }
                );
            } else {
                results += `‚ùå Geolocation not supported in this browser\n`;
                resultDiv.innerHTML = `<span class="error">‚ùå CoreLocation Test - Geolocation Not Supported:</span>
<pre>${results}</pre>`;
            }
        }

        function testErrorHandlingFunction() {
            const resultDiv = document.getElementById('handling-result');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö Error Handling Function...';
            
            const testErrors = [
                { name: 'Empty Object', error: {} },
                { name: 'Permission Denied', error: { code: 1, message: 'Permission denied' } },
                { name: 'Position Unavailable', error: { code: 2, message: 'Position unavailable' } },
                { name: 'Timeout', error: { code: 3, message: 'Timeout' } },
                { name: 'Regular Error', error: new Error('Test error message') },
                { name: 'String Error', error: 'String error message' },
                { name: 'Null Error', error: null },
                { name: 'Undefined Error', error: undefined }
            ];
            
            let results = 'üß™ Error Handling Test Results:\n\n';
            
            testErrors.forEach((test, index) => {
                results += `${index + 1}. ${test.name}:\n`;
                const errorResult = logGeolocationError(test.error, `test ${index + 1}`);
                results += `   Result: ${JSON.stringify(errorResult, null, 2)}\n\n`;
            });
            
            resultDiv.innerHTML = `<span class="success">‚úÖ Error Handling Test Complete:</span>
<pre>${results}</pre>`;
        }

        // Auto-run basic tests on page load
        window.addEventListener('load', () => {
            console.log('üß™ Geolocation Error Handling Test Page Loaded');
            console.log('Available tests:');
            console.log('1. testNormalGeolocation()');
            console.log('2. testPermissionDenied()');
            console.log('3. testPositionUnavailable()');
            console.log('4. testTimeout()');
            console.log('5. testEmptyObjectError()');
            console.log('6. testCoreLocationError()');
            console.log('7. testErrorHandlingFunction()');
        });
    </script>
</body>
</html>
