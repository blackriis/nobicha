<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô/‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .image-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }
        .image-card h4 {
            margin-top: 0;
            color: #555;
            font-size: 14px;
        }
        .image-container {
            width: 100%;
            height: 200px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            margin-top: 10px;
        }
        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }
        .status {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        .placeholder { background: #e2e3e5; color: #383d41; }
        .url-info {
            font-size: 10px;
            color: #666;
            word-break: break-all;
            margin-top: 5px;
        }
        .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô/‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</h1>
        
        <button class="refresh-btn" onclick="loadTimeEntries()">üîÑ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
        
        <div class="test-section">
            <h3>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Time Entries</h3>
            <div id="time-entries-info">
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üñºÔ∏è ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô/‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</h3>
            <div id="images-container">
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div id="test-summary">
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</p>
            </div>
        </div>
    </div>

    <script>
        let timeEntries = [];
        let testResults = [];

        async function loadTimeEntries() {
            try {
                console.log('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• time entries...');
                
                // ‡πÉ‡∏ä‡πâ Supabase client-side
                const { createClient } = supabase;
                const supabaseUrl = 'https://nyhwnafkybuxneqiaffq.supabase.co';
                const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55aHduYWZreWJ1eG5lcWlhZmZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNzY2MDcsImV4cCI6MjA3NDY1MjYwN30.8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8QZ8';
                
                const supabaseClient = createClient(supabaseUrl, supabaseKey);
                
                const { data, error } = await supabaseClient
                    .from('time_entries')
                    .select('id, check_in_time, check_in_selfie_url, check_out_selfie_url, branch:branches(name)')
                    .order('check_in_time', { ascending: false })
                    .limit(5);
                
                if (error) {
                    throw error;
                }
                
                timeEntries = data || [];
                displayTimeEntries();
                testImages();
                
            } catch (error) {
                console.error('‚ùå Error loading time entries:', error);
                document.getElementById('time-entries-info').innerHTML = `
                    <div class="error">
                        <p>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${error.message}</p>
                    </div>
                `;
            }
        }

        function displayTimeEntries() {
            const container = document.getElementById('time-entries-info');
            
            if (timeEntries.length === 0) {
                container.innerHTML = '<p>üì≠ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• time entries</p>';
                return;
            }
            
            let html = `<p>üìä ‡∏û‡∏ö time entries: ${timeEntries.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;
            
            timeEntries.forEach((entry, i) => {
                html += `
                    <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <strong>${i+1}. ID: ${entry.id}</strong><br>
                        <span>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(entry.check_in_time).toLocaleString('th-TH')}</span><br>
                        <span>üè¢ ‡∏™‡∏≤‡∏Ç‡∏≤: ${entry.branch?.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span><br>
                        <span>üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô: ${entry.check_in_selfie_url ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</span><br>
                        <span>üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå: ${entry.check_out_selfie_url ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        async function testImages() {
            const container = document.getElementById('images-container');
            testResults = [];
            
            if (timeEntries.length === 0) {
                container.innerHTML = '<p>üì≠ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>';
                return;
            }
            
            let html = '';
            
            for (const entry of timeEntries) {
                html += `<div class="image-grid">`;
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô
                if (entry.check_in_selfie_url) {
                    html += `
                        <div class="image-card">
                            <h4>üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</h4>
                            <div class="image-container" id="checkin-${entry.id}">
                                <img src="${entry.check_in_selfie_url}" 
                                     alt="‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô" 
                                     onload="handleImageLoad('checkin-${entry.id}', '${entry.check_in_selfie_url}', true)"
                                     onerror="handleImageError('checkin-${entry.id}', '${entry.check_in_selfie_url}', true)">
                                <div class="status loading" id="status-checkin-${entry.id}">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                            </div>
                            <div class="url-info">${entry.check_in_selfie_url}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="image-card">
                            <h4>üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</h4>
                            <div class="image-container">
                                <img src="/placeholder-selfie.svg" alt="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" style="width: 64px; height: 64px; opacity: 0.5;">
                                <div class="status placeholder">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
                            </div>
                        </div>
                    `;
                }
                
                // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå
                if (entry.check_out_selfie_url) {
                    html += `
                        <div class="image-card">
                            <h4>üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</h4>
                            <div class="image-container" id="checkout-${entry.id}">
                                <img src="${entry.check_out_selfie_url}" 
                                     alt="‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå" 
                                     onload="handleImageLoad('checkout-${entry.id}', '${entry.check_out_selfie_url}', false)"
                                     onerror="handleImageError('checkout-${entry.id}', '${entry.check_out_selfie_url}', false)">
                                <div class="status loading" id="status-checkout-${entry.id}">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                            </div>
                            <div class="url-info">${entry.check_out_selfie_url}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="image-card">
                            <h4>üì∏ ‡∏£‡∏π‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</h4>
                            <div class="image-container">
                                <img src="/placeholder-selfie.svg" alt="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û" style="width: 64px; height: 64px; opacity: 0.5;">
                                <div class="status placeholder">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>
                            </div>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }

        function handleImageLoad(elementId, url, isCheckin) {
            const statusElement = document.getElementById(`status-${elementId}`);
            statusElement.textContent = '‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
            statusElement.className = 'status success';
            
            testResults.push({
                type: isCheckin ? 'checkin' : 'checkout',
                url: url,
                status: 'success'
            });
            
            updateSummary();
        }

        function handleImageError(elementId, url, isCheckin) {
            const statusElement = document.getElementById(`status-${elementId}`);
            statusElement.textContent = '‚ùå ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
            statusElement.className = 'status error';
            
            // ‡πÅ‡∏™‡∏î‡∏á placeholder image
            const container = document.getElementById(elementId);
            container.innerHTML = `
                <img src="/placeholder-selfie.svg" alt="‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ" style="width: 64px; height: 64px; opacity: 0.5;">
                <div class="status error">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</div>
            `;
            
            testResults.push({
                type: isCheckin ? 'checkin' : 'checkout',
                url: url,
                status: 'error'
            });
            
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('test-summary');
            
            const successCount = testResults.filter(r => r.status === 'success').length;
            const errorCount = testResults.filter(r => r.status === 'error').length;
            const totalCount = testResults.length;
            
            if (totalCount > 0) {
                summary.innerHTML = `
                    <p><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</strong></p>
                    <p>‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${successCount}/${totalCount}</p>
                    <p>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${errorCount}/${totalCount}</p>
                    <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${successCount === totalCount ? 'üéâ ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô' : '‚ö†Ô∏è ‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'}</p>
                `;
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', loadTimeEntries);
    </script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
