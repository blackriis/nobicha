# Story 5.6: Employee Dashboard Component Consistency - Brownfield Enhancement

## Status
Ready for Review

## User Story

As an **Employee** navigating between dashboard pages,
I want **all dashboard pages to use consistent component patterns and layout structures**,
So that **I have a familiar and predictable user experience across all sections**.

## Story Context

**Existing System Integration:**

- Integrates with: All employee dashboard pages (`/dashboard/*`)
- Technology: Next.js 15 + TypeScript + Shadcn UI + Tailwind CSS
- Follows pattern: Apply work-history page as the standard template for all dashboard pages
- Touch points: Dashboard navigation, page layouts, component selection standards

## Acceptance Criteria

**Functional Requirements:**

1. **Layout Standardization:**
   - All dashboard pages use consistent container sizing (`max-w-6xl mx-auto`)
   - Background classes are uniform (`bg-gray-50 dark:bg-black`)
   - Padding and spacing follow same pattern (`py-6 px-4 sm:px-6 lg:px-8 space-y-6`)
   - ProtectedRoute wrapper used consistently across all pages

2. **Header Pattern Consistency:**
   - Replace inconsistent header implementations with work-history header pattern
   - Use `div` structure instead of Card wrapper for page headers
   - Include action buttons (refresh/retry) where appropriate
   - Title and description styling follows work-history format

3. **Loading State Standardization:**
   - Replace custom loading spinners with work-history loading pattern
   - Use `RefreshCw` icon with `animate-spin` class consistently
   - Loading card structure matches work-history implementation
   - Loading messages use consistent Thai text patterns

4. **Error Handling Alignment:**
   - Replace custom error styling with work-history error patterns
   - Use Shadcn `Alert` component with `destructive` variant
   - Error card structure and retry buttons follow work-history design
   - User-friendly Thai error messages maintain consistency

5. **Component Selection Standards:**
   - Remove Card wrappers from page headers (follow work-history pattern)
   - Use Shadcn design tokens consistently for colors and spacing
   - Replace hardcoded background colors with design system variables
   - Maintain same hover states and transitions across components

6. **Navigation Integration:**
   - Ensure all pages work correctly with EmployeeDashboardHeader navigation
   - Page active states display properly in tab navigation
   - Mobile responsive behavior consistent across all pages

**Integration Requirements:**

7. **Existing functionality remains unchanged** - No business logic modifications
8. **API integrations continue to work correctly** - No backend changes required
9. **Component behavior maintains current patterns** - Only visual consistency improvements

**Quality Requirements:**

10. **Changes don't affect existing workflows** - All user flows work as before
11. **Responsive behavior maintained** - Mobile and desktop layouts work correctly
12. **Performance impact is minimal** - Only CSS and component structure changes

## Technical Notes

**Integration Approach:** 
Apply work-history page patterns as the standard template for all employee dashboard pages, focusing only on layout, component selection, and visual consistency without changing functionality.

**Existing Pattern Reference:** 
- Standard template: `apps/web/src/app/dashboard/work-history/page.tsx`
- Header pattern: `apps/web/src/components/employee/WorkHistoryPage.tsx` (lines 75-98)
- Loading pattern: `apps/web/src/components/employee/WorkHistoryPage.tsx` (lines 108-115)
- Error pattern: `apps/web/src/components/employee/WorkHistoryPage.tsx` (lines 118-134)

**Key Constraints:** 
- Must preserve all existing functionality in each dashboard page
- Component logic and data handling should remain unchanged
- Focus only on visual consistency and component selection

## Definition of Done

- [x] All dashboard pages use consistent layout containers (`max-w-6xl mx-auto`)
- [x] Background classes standardized (`bg-gray-50 dark:bg-black`)
- [x] Page headers follow work-history pattern (no Card wrappers)
- [x] Loading states use RefreshCw spinner consistently
- [x] Error handling uses Alert component with destructive variant
- [x] All pages maintain existing functionality without regression
- [x] Navigation between pages works correctly
- [x] Mobile responsive behavior preserved
- [x] Component selection follows work-history standards

## Implementation Details

### Current vs Target Patterns

**❌ Current Material Usage Page:**
```typescript
// Inconsistent layout and header pattern
<div className="min-h-screen bg-background"> {/* Wrong background */}
  <EmployeeDashboardHeader />
  <div className="max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8"> {/* Good container */}
    {/* Page Header - WRONG: Using Card wrapper */}
    <Card className="mb-6">
      <CardHeader>
        <div className="flex items-center gap-3">
          <Package className="h-8 w-8 text-primary" />
          <CardTitle className="text-3xl font-bold">รายงานการใช้วัตถุดิบ</CardTitle>
        </div>
      </CardHeader>
      <CardContent>
        <p className="text-sm text-muted-foreground">...</p>
      </CardContent>
    </Card>
  </div>
</div>
```

**✅ Target Pattern (Following Work-History):**
```typescript
// Consistent with work-history standard
<div className="min-h-screen bg-gray-50 dark:bg-black"> {/* Correct background */}
  <EmployeeDashboardHeader />
  <div className="max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6"> {/* Consistent container */}
    {/* Header Section - Following work-history pattern */}
    <div className="flex justify-between items-center">
      <div>
        <h1 className="text-2xl font-bold text-gray-900">รายงานการใช้วัตถุดิบ</h1>
        <p className="text-sm text-gray-600 mt-1">
          บันทึกการใช้วัตถุดิบในระหว่างการทำงาน เพื่อการติดตามต้นทุนที่แม่นยำ
        </p>
      </div>
      {/* Action button if needed */}
      <Button variant="outline" size="sm" onClick={handleRefresh}>
        <RefreshCw className="h-4 w-4 mr-2" />
        รีเฟรช
      </Button>
    </div>
    
    {/* Main Content */}
    <MaterialUsageForm />
  </div>
</div>
```

**❌ Current Daily Sales Loading:**
```typescript
// Custom loading spinner - inconsistent
<div className="animate-spin rounded-full h-8 w-8 border-2 border-blue-300 border-t-blue-600" />
```

**✅ Target Loading Pattern:**
```typescript
// Following work-history loading pattern
<Card>
  <CardContent className="p-8 text-center">
    <RefreshCw className="h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground" />
    <p className="text-muted-foreground">กำลังโหลดข้อมูล...</p>
  </CardContent>
</Card>
```

**❌ Current Daily Sales Error:**
```typescript
// Custom error styling - inconsistent
<Card className="max-w-lg mx-auto border-l-4 border-l-amber-500">
  <CardContent className="py-6">
    <div className="flex items-start gap-4">
      <Clock className="h-6 w-6 text-amber-500 mt-1" />
      <div>
        <h3 className="font-medium text-amber-800 mb-1">ต้องเช็คอินก่อน</h3>
        <p className="text-sm text-amber-600 mb-3">{checkInError}</p>
      </div>
    </div>
  </CardContent>
</Card>
```

**✅ Target Error Pattern:**
```typescript
// Following work-history error pattern
<Card className="border-destructive">
  <CardContent className="p-8 text-center">
    <div className="text-destructive mb-4">
      <h3 className="font-medium">ต้องเช็คอินก่อน</h3>
      <p className="text-sm mt-1">{checkInError}</p>
    </div>
    <Button variant="outline" size="sm" onClick={handleRetry}>
      ลองอีกครั้ง
    </Button>
  </CardContent>
</Card>
```

### Files to Modify

**1. Material Usage Page:**
- File: `/apps/web/src/app/dashboard/material-usage/page.tsx`
- Changes: 
  - Fix background class: `bg-background` → `bg-gray-50 dark:bg-black`
  - Remove Card wrapper from header
  - Apply work-history header pattern
  - Add space-y-6 to container

**2. Daily Sales Page:**
- File: `/apps/web/src/app/dashboard/daily-sales/page.tsx`
- Changes:
  - Fix container: `container mx-auto` → `max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6`
  - Standardize loading spinner to RefreshCw pattern
  - Update error handling to use Alert component
  - Apply consistent header styling

**3. Dashboard Main Page:**
- File: `/apps/web/src/app/dashboard/page.tsx`
- Changes:
  - Update container: `max-w-4xl` → `max-w-6xl` (for consistency)
  - Ensure background class matches other pages
  - Add space-y-6 if needed for future content

### Component Pattern Standards

**Layout Container Standard:**
```typescript
<div className="min-h-screen bg-gray-50 dark:bg-black">
  <EmployeeDashboardHeader />
  <div className="max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6">
    {/* Page content */}
  </div>
</div>
```

**Header Pattern Standard:**
```typescript
<div className="flex justify-between items-center">
  <div>
    <h1 className="text-2xl font-bold text-gray-900">{pageTitle}</h1>
    <p className="text-sm text-gray-600 mt-1">{pageDescription}</p>
  </div>
  {/* Optional action button */}
  <Button variant="outline" size="sm" onClick={handleAction}>
    <RefreshCw className="h-4 w-4 mr-2" />
    {actionLabel}
  </Button>
</div>
```

**Loading State Standard:**
```typescript
<Card>
  <CardContent className="p-8 text-center">
    <RefreshCw className="h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground" />
    <p className="text-muted-foreground">{loadingMessage}</p>
  </CardContent>
</Card>
```

**Error State Standard:**
```typescript
<Card className="border-destructive">
  <CardContent className="p-8 text-center">
    <div className="text-destructive mb-4">
      <h3 className="font-medium">{errorTitle}</h3>
      <p className="text-sm mt-1">{errorMessage}</p>
    </div>
    <Button variant="outline" size="sm" onClick={handleRetry}>
      {retryLabel}
    </Button>
  </CardContent>
</Card>
```

### Testing Strategy

**Visual Regression Tests:**
- Verify all pages have consistent layout and spacing
- Check header patterns match across pages
- Validate loading and error states visual consistency

**Navigation Tests:**
- Test tab navigation between all dashboard pages
- Verify active page indication works correctly
- Check mobile navigation behavior

**Functionality Tests:**
- Ensure all existing functionality works after layout changes
- Test responsive behavior on mobile and desktop
- Verify no regression in user workflows

### Accessibility Considerations

- Maintain heading hierarchy consistency
- Preserve focus management between pages
- Ensure color contrast meets standards with new patterns
- Keep keyboard navigation working correctly

## Risk Mitigation

**Primary Risk:** Layout changes might affect responsive behavior or break existing functionality
**Mitigation:** Focus only on layout containers and component selection, avoid changing component logic
**Rollback Plan:** Revert specific files to original layout patterns if issues occur

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-01 | 1.0 | Initial story for employee dashboard consistency | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 - Full Stack Developer

### Debug Log References
- Build successful: npm run build completed without TypeScript errors
- Tests passing: Dashboard consistency tests verified standards implementation
- Component imports updated: Removed unused Package icon, added Button and Alert imports

### Completion Notes List
- **Layout Standardization**: Successfully updated all dashboard pages to use consistent `max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6` container
- **Background Consistency**: Changed Material Usage page from `bg-background` to `bg-gray-50 dark:bg-black` to match other pages
- **Header Pattern Alignment**: Removed Card wrapper from Material Usage page header, applied work-history pattern with `flex justify-between items-center`
- **Loading State Standardization**: Updated Daily Sales page to use RefreshCw spinner pattern instead of custom border spinner
- **Error Handling Improvement**: Converted Daily Sales error state from custom Card styling to destructive Alert pattern
- **Container Size Consistency**: Updated Dashboard main page container from `max-w-4xl` to `max-w-6xl` for consistency
- **Action Button Integration**: Added refresh button with RefreshCw icon to Daily Sales page header

### File List
**Modified Files:**
- `apps/web/src/app/dashboard/material-usage/page.tsx` - Layout standardization and header pattern fix
- `apps/web/src/app/dashboard/daily-sales/page.tsx` - Loading/error patterns and container updates  
- `apps/web/src/app/dashboard/page.tsx` - Container size consistency update
- `apps/web/src/__tests__/components/dashboard-consistency.test.tsx` - Comprehensive test coverage for consistency standards

**Technical Changes:**
- Background classes: `bg-background` → `bg-gray-50 dark:bg-black`
- Container patterns: Various → consistent `max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6`
- Header structure: Card wrapper → `div` with `flex justify-between items-center`
- Loading spinners: Custom CSS → `RefreshCw animate-spin` component
- Error styling: Custom Card styling → `border-destructive` Alert pattern
- Import additions: Button, Alert, RefreshCw components for consistency

## QA Results
*To be populated after QA review*