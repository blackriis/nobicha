# Story 5.5: Employee Sales Report Design Consistency - Brownfield Enhancement

## Status
Ready for Implementation

## User Story

As an **Employee** using the sales report feature,
I want **the sales report page to follow the same design patterns as work-history page**,
So that **I have a consistent and familiar user experience across all employee dashboard pages**.

## Story Context

**Existing System Integration:**

- Integrates with: Current SalesReportHistory component (`/apps/web/src/components/employee/SalesReportHistory.tsx`)
- Technology: Next.js 15 + TypeScript + Shadcn UI + Sales Reports Service
- Follows pattern: Apply work-history page structure (ProtectedRoute → Header → Container → Cards)
- Touch points: Employee dashboard, sales reporting workflow, mobile navigation

## Acceptance Criteria

**Functional Requirements:**

1. **Page Layout Standardization:**
   - Create dedicated sales report page with work-history page structure
   - Implement ProtectedRoute wrapper with employee role validation
   - Add consistent header section with title, description, and action buttons
   - Use same container layout (max-w-6xl, responsive padding, space-y-6)

2. **Filter System Implementation:**
   - Add date range filter similar to work-history DateRangeFilter
   - Support filtering by: today, this week, this month, custom date range
   - Integrate filter state with sales report API calls
   - Maintain filter state during component lifecycle

3. **Card Design Consistency:**
   - Replace ReportItem div structure with Shadcn Card component
   - Follow TimeEntryCard pattern: Card → CardContent → Header → Grid → Action
   - Use consistent Badge variants for status indicators (today/past reports)
   - Implement same hover states and transitions as work-history cards

4. **Loading States Standardization:**
   - Replace custom loading spinner with work-history loading pattern
   - Use RefreshCw icon with animate-spin from work-history
   - Implement same loading card structure with consistent messaging
   - Add refresh button in header section like work-history

5. **Empty State Consistency:**
   - Replace current empty state with EmptyStateMessage pattern
   - Use Calendar icon and consistent empty state messaging structure
   - Match text styling and layout from work-history empty states
   - Add contextual messages based on selected date filter

6. **Error Handling Alignment:**
   - Standardize error card design with work-history error patterns
   - Use destructive border and consistent error messaging
   - Implement same retry button styling and functionality
   - Maintain user-friendly Thai error messages

**Integration Requirements:**

7. **Existing sales reporting APIs remain unchanged** - No backend modifications required
8. **Sales report functionality continues to work unchanged** - All current features preserved
9. **Integration with existing navigation maintains current behavior** - Dashboard links work correctly

**Quality Requirements:**

10. **Changes are covered by component tests** - Test new page layout and card designs
11. **Responsive behavior works on mobile and desktop** - Maintain mobile-first approach
12. **No regression in existing sales reporting workflow** - All user flows work correctly

## Technical Notes

**Integration Approach:** 
- Create new sales report page following work-history page structure
- Refactor SalesReportHistory component to use consistent design patterns
- Maintain all existing functionality while improving visual consistency

**Existing Pattern Reference:** 
- Work-history page: `apps/web/src/app/dashboard/work-history/page.tsx`
- WorkHistoryPage component: `apps/web/src/components/employee/WorkHistoryPage.tsx`
- TimeEntryCard patterns: `apps/web/src/components/employee/TimeEntryCard.tsx`
- EmptyStateMessage: `apps/web/src/components/employee/EmptyStateMessage.tsx`

**Key Constraints:** 
- Must maintain all existing sales report functionality
- Date filtering should work with existing SalesReportsService API
- Performance impact must be minimal (UI-only improvements)

## Definition of Done

- [ ] New sales report page created with work-history page structure
- [ ] SalesReportHistory component refactored to use Card components
- [ ] Date range filter implemented for sales reports
- [ ] Loading states standardized with work-history patterns
- [ ] Empty states follow EmptyStateMessage design
- [ ] Error handling consistent with work-history error patterns
- [ ] All existing sales report functionality works without regression
- [ ] Component tests cover new page layout and functionality
- [ ] Mobile and desktop responsive behavior verified
- [ ] Code follows existing TypeScript patterns and standards

## Implementation Details

### Current vs Target Design Comparison

**Current Structure (SalesReportHistory.tsx):**
```typescript
// ❌ Current - Inconsistent patterns
<Card>
  <CardHeader>
    <div className="flex items-center justify-between">
      <CardTitle>ประวัติรายงานยอดขาย</CardTitle>
      <Button variant="ghost">Refresh</Button>
    </div>
  </CardHeader>
  <CardContent>
    {reports.map(report => (
      <div className="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
        {/* Custom styling, not using Card component */}
      </div>
    ))}
  </CardContent>
</Card>
```

**Target Structure (Following work-history):**
```typescript
// ✅ Target - Consistent with work-history patterns
<ProtectedRoute allowedRoles={['employee']}>
  <div className="min-h-screen bg-gray-50 dark:bg-black">
    <EmployeeDashboardHeader />
    <div className="max-w-6xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-6">
      {/* Header Section */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">รายงานยอดขาย</h1>
          <p className="text-sm text-gray-600 mt-1">ประวัติการรายงานยอดขายรายวัน</p>
        </div>
        <Button variant="outline" onClick={handleRefresh}>
          <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />
          รีเฟรช
        </Button>
      </div>

      {/* Date Range Filter */}
      <SalesDateRangeFilter
        value={selectedRange}
        onChange={handleRangeChange}
        disabled={isLoading}
      />

      {/* Content States */}
      {isLoading && <LoadingState />}
      {error && <ErrorState />}
      {!isLoading && !error && (
        <>
          {reports.length > 0 ? (
            <div className="space-y-0">
              {reports.map(report => (
                <SalesReportCard 
                  key={report.id} 
                  report={report} 
                  onViewDetails={handleViewDetails}
                />
              ))}
            </div>
          ) : (
            <EmptyStateMessage dateRange={selectedRange} />
          )}
        </>
      )}
    </div>
  </div>
</ProtectedRoute>
```

### New Components to Create

**1. Sales Report Page:**
```typescript
// /apps/web/src/app/dashboard/sales-reports/page.tsx
import React from 'react'
import { SalesReportPage } from '@/components/employee/SalesReportPage'

export default function SalesReportsRoute() {
  return <SalesReportPage />
}

export const metadata = {
  title: 'รายงานยอดขาย | Employee Management System',
  description: 'ประวัติการรายงานยอดขายรายวัน รายสัปดาห์ และรายเดือน'
}
```

**2. SalesReportCard Component:**
```typescript
// Following TimeEntryCard pattern
interface SalesReportCardProps {
  report: SalesReportWithBranch
  onViewDetails?: (reportId: string) => void
}

export function SalesReportCard({ report, onViewDetails }: SalesReportCardProps) {
  const isToday = isReportToday(report.report_date)
  const formattedDate = formatThaiDate(report.report_date)
  const formattedAmount = formatThaiCurrency(report.total_sales)
  
  return (
    <Card className="mb-3">
      <CardContent className="p-4">
        <div className="flex justify-between items-start mb-2">
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-1">
              <h3 className="font-medium text-sm">{formattedDate}</h3>
              <Badge 
                variant={isToday ? 'default' : 'secondary'}
                className="text-xs"
              >
                {isToday ? 'วันนี้' : 'ผ่านมาแล้ว'}
              </Badge>
            </div>
            <p className="text-sm text-muted-foreground">{report.branches.name}</p>
          </div>
          <div className="text-right">
            <p className="text-sm font-medium text-green-600">{formattedAmount}</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <p className="text-muted-foreground">วันที่รายงาน</p>
            <p className="font-medium">{formattedDate}</p>
          </div>
          <div>
            <p className="text-muted-foreground">ยอดขายรวม</p>
            <p className="font-medium text-green-600">{formattedAmount}</p>
          </div>
        </div>

        {/* Action Button */}
        {onViewDetails && (
          <div className="mt-3 pt-3 border-t">
            <Button
              variant="outline"
              size="sm"
              onClick={() => onViewDetails(report.id)}
              className="w-full flex items-center justify-center space-x-2 h-8 text-xs"
            >
              <Eye className="h-3 w-3" />
              <span>ดูสลิป</span>
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

**3. SalesDateRangeFilter Component:**
```typescript
// Similar to DateRangeFilterComponent from work-history
interface SalesDateRangeFilterProps {
  value: DateRangeFilter
  onChange: (value: DateRangeFilter) => void
  disabled?: boolean
}

export function SalesDateRangeFilter({ value, onChange, disabled }: SalesDateRangeFilterProps) {
  // Implementation following work-history DateRangeFilterComponent pattern
}
```

**4. Sales Empty State Component:**
```typescript
// Following EmptyStateMessage pattern
interface SalesEmptyStateProps {
  dateRange: DateRangeFilter
}

export function SalesEmptyState({ dateRange }: SalesEmptyStateProps) {
  const rangeLabel = getSalesDateRangeLabel(dateRange)
  
  return (
    <Card>
      <CardContent className="p-8 text-center">
        <div className="flex justify-center mb-4">
          <Calendar className="h-12 w-12 text-muted-foreground/50" />
        </div>
        <h3 className="text-lg font-medium mb-2">ไม่มีรายงานยอดขาย</h3>
        <p className="text-muted-foreground">
          ไม่พบรายงานยอดขายในช่วง{rangeLabel}
        </p>
        <p className="text-sm text-muted-foreground mt-2">
          กรุณาเลือกช่วงเวลาอื่น หรือสร้างรายงานใหม่
        </p>
      </CardContent>
    </Card>
  )
}
```

### File Structure Changes

**New Files to Create:**
- `/apps/web/src/app/dashboard/sales-reports/page.tsx` - Main sales report page
- `/apps/web/src/components/employee/SalesReportPage.tsx` - Page component
- `/apps/web/src/components/employee/SalesReportCard.tsx` - Individual report card
- `/apps/web/src/components/employee/SalesDateRangeFilter.tsx` - Date filtering
- `/apps/web/src/components/employee/SalesEmptyState.tsx` - Empty state message

**Files to Modify:**
- `/apps/web/src/components/employee/SalesReportHistory.tsx` - Refactor to use new components

### API Integration Points

**Existing APIs to Use:**
- `SalesReportsService.getReports()` - Get all reports
- `SalesReportsService.getTodaysReport()` - Get today's reports  
- Need to add date range filtering to service layer

**New Service Methods Needed:**
```typescript
// In sales-reports.service.ts
export class SalesReportsService {
  static async getReportsByDateRange(dateRange: DateRangeFilter): Promise<SalesReportListResponse> {
    // Implementation for date range filtering
  }
}
```

### Testing Strategy

**Component Tests (Vitest + RTL):**
- SalesReportPage renders all sections correctly
- SalesReportCard displays data and handles click actions
- SalesDateRangeFilter handles date changes
- SalesEmptyState shows appropriate messages
- Loading and error states work correctly

**Integration Tests:**
- Sales report page navigation from dashboard
- Date filtering updates report list
- Report card click opens slip image
- Responsive behavior on mobile/desktop

**E2E Tests (Playwright):**
- Complete sales report workflow
- Date range filtering functionality
- Report detail viewing
- Mobile navigation and interactions

### Accessibility Requirements

- All interactive elements have proper focus indicators
- Screen reader announcements for loading states
- Keyboard navigation works for all components
- Touch targets meet minimum size requirements
- Color contrast meets WCAG standards

### Performance Considerations

- Component memoization for report list rendering
- Lazy loading for report images
- Optimized date filtering without excessive API calls
- Maintain layout stability during loading states

## Risk Mitigation

**Primary Risk:** Refactoring sales report component might break existing workflow
**Mitigation:** Incremental refactoring, maintain existing functionality, comprehensive testing
**Rollback Plan:** Keep original SalesReportHistory component as backup, gradual deployment

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-01 | 1.0 | Initial story creation for sales report consistency | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 - Product Owner Agent

### Analysis Notes
- Current SalesReportHistory has good functionality but inconsistent design
- ReportItem uses custom div styling instead of Card components
- Missing page-level structure and filtering capabilities
- Loading states don't follow work-history design tokens
- Empty states need EmptyStateMessage pattern alignment

### Priority Implementation Order
1. Create new sales report page with work-history structure
2. Refactor SalesReportCard to follow TimeEntryCard pattern
3. Add date range filtering capability
4. Standardize loading and empty states
5. Test and validate all existing functionality preserved

## QA Results
*To be populated after QA review*