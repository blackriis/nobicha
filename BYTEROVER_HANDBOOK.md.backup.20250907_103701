# Byterover Handbook - Employee Management System

## Layer 1: System Overview ğŸ¯

### Purpose
Employee Management System (à¸£à¸°à¸šà¸šà¸šà¸£à¸´à¸«à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸™à¸±à¸à¸‡à¸²à¸™) - A comprehensive fullstack Thai employee management application with GPS-based check-in/out functionality, branch management, and payroll processing.

### Architecture Pattern
**Serverless Monorepo Architecture** with Next.js App Router
- **Primary Pattern**: Feature-based modular architecture with service layer abstraction
- **Secondary Pattern**: Component-driven UI with Supabase backend integration
- **Deployment**: Vercel serverless platform

### Tech Stack Core
```typescript
Frontend: Next.js 15.5 + TypeScript 5 + React 19
UI: Shadcn UI + Tailwind CSS 4 + Radix UI
State: Zustand 5.0 (for complex state management)
Backend: Next.js API Routes (serverless)
Database: Supabase PostgreSQL + Auth + Storage
Testing: Vitest + RTL + Playwright E2E
Validation: Zod 4.1 + React Hook Form 7.62
```

### Key Technical Decisions
- **Monorepo Structure**: npm workspaces for code sharing
- **Service Layer Pattern**: Abstract API calls from components
- **Feature-based Organization**: Modular component structure
- **Role-based Authentication**: Admin/Employee access control
- **GPS Integration**: HTML5 Geolocation + Haversine calculations

## Layer 2: Module Map ğŸ“

### Core Business Modules
```
ğŸ¢ Branch Management
â”œâ”€â”€ Location: apps/web/src/components/admin/
â”œâ”€â”€ Purpose: GPS-based branch creation and management
â””â”€â”€ Key Files: BranchList.tsx, BranchForm.tsx, WorkShiftForm.tsx

ğŸ‘¤ User Authentication & Roles
â”œâ”€â”€ Location: apps/web/src/components/auth/
â”œâ”€â”€ Purpose: Supabase-based auth with admin/employee roles
â””â”€â”€ Key Files: AuthProvider.tsx, LoginForm.tsx, ProtectedRoute.tsx

â° Time Tracking (Future)
â”œâ”€â”€ Location: apps/web/src/features/ (to be created)
â”œâ”€â”€ Purpose: GPS-validated check-in/out with selfie verification
â””â”€â”€ Dependencies: Branch Management, Location Services

ğŸ’° Payroll Management (Future)
â”œâ”€â”€ Location: apps/web/src/features/ (to be created)
â”œâ”€â”€ Purpose: Automated payroll calculation and reporting
â””â”€â”€ Dependencies: Time Tracking, User Management
```

### Technical Infrastructure
```
ğŸ”§ Services Layer
â”œâ”€â”€ Location: apps/web/src/lib/services/
â”œâ”€â”€ Purpose: API abstraction and business logic
â””â”€â”€ Current: user.service.ts, index.ts

ğŸ›  Utilities & Config
â”œâ”€â”€ Location: apps/web/src/lib/
â”œâ”€â”€ Purpose: Shared utilities, validation, auth helpers
â””â”€â”€ Key Files: supabase.ts, auth.ts, validation.ts, utils.ts

ğŸ“¦ Shared Packages
â”œâ”€â”€ Location: packages/
â”œâ”€â”€ Purpose: Cross-app shared code (types, UI, config)
â””â”€â”€ Packages: @employee-management/{database,ui,config}
```

### Data Layer
```
ğŸ—„ Database Schema (Supabase)
â”œâ”€â”€ Core Tables: branches, users, work_shifts
â”œâ”€â”€ Future Tables: time_entries, payroll_cycles, sales_reports
â””â”€â”€ Migrations: database/migrations/*.sql
```

## Layer 3: Integration Guide ğŸ”—

### API Architecture
**Base Path**: `/api/`
**Pattern**: RESTful endpoints with role-based access

```typescript
// Admin Endpoints (Protected)
GET    /api/admin/branches          // List all branches
POST   /api/admin/branches          // Create branch
PUT    /api/admin/branches/[id]     // Update branch
DELETE /api/admin/branches/[id]     // Delete branch

GET    /api/admin/branches/[id]/shifts // List shifts for branch
POST   /api/admin/branches/[id]/shifts // Create shift
PUT    /api/admin/shifts/[id]          // Update shift
DELETE /api/admin/shifts/[id]          // Delete shift

// Employee Endpoints
GET    /api/employee/available-branches // GPS-filtered branches

// Location Services
POST   /api/location/nearby-branches    // Find branches within 100m radius
```

### Authentication Flow
```typescript
// Middleware: apps/web/src/middleware.ts
// Auth Provider: apps/web/src/components/auth/AuthProvider.tsx
// Routes:
//   - /login/admin     -> Admin login
//   - /login/employee  -> Employee login
//   - /admin/*         -> Admin dashboard (protected)
//   - /dashboard/*     -> Employee dashboard (protected)
```

### Configuration Management
```typescript
// Environment Variables (via packages/config)
SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY

// Database Types (via packages/database)
import { User, Branch, WorkShift } from '@employee-management/database'

// Shared UI Components (via packages/ui)
import { Button, Form, Input } from '@employee-management/ui'
```

### GPS Integration Specifications
```typescript
// Location Services: apps/web/src/lib/utils/gps.utils.ts
- HTML5 Geolocation API for user location
- Haversine formula for distance calculations
- 100-meter radius validation for check-ins
- Error handling for GPS disabled/unavailable
- Permission request management
```

## Layer 4: Extension Points ğŸ”§

### Design Patterns in Use
```typescript
ğŸ¯ Service Layer Pattern
â”œâ”€â”€ Abstract API calls from components
â”œâ”€â”€ Centralize business logic
â””â”€â”€ Example: apps/web/src/lib/services/user.service.ts

ğŸ›¡ Protected Route Pattern
â”œâ”€â”€ Role-based access control
â”œâ”€â”€ Authentication middleware
â””â”€â”€ Example: apps/web/src/components/auth/ProtectedRoute.tsx

ğŸ“± Feature-based Architecture
â”œâ”€â”€ Organize code by business features
â”œâ”€â”€ Encapsulate related functionality
â””â”€â”€ Structure: apps/web/src/features/[feature]/
```

### Customization Areas
```typescript
ğŸ¨ UI Theme & Localization
â”œâ”€â”€ Modify: apps/web/src/app/globals.css
â”œâ”€â”€ Extend: Tailwind config for Thai-specific styling
â””â”€â”€ Localize: All text content in Thai language

ğŸ—„ Database Schema Extensions
â”œâ”€â”€ Add tables: database/migrations/
â”œâ”€â”€ Extend types: packages/database/types.ts
â””â”€â”€ Update services: apps/web/src/lib/services/

ğŸ“ GPS & Location Features
â”œâ”€â”€ Customize radius: 100m default (configurable)
â”œâ”€â”€ Add map integration: Optional GPS picker component
â””â”€â”€ Extend location validation: Custom business rules
```

### Development Workflow Extensions
```typescript
ğŸ§ª Testing Patterns
â”œâ”€â”€ Unit Tests: apps/web/src/__tests__/
â”œâ”€â”€ API Tests: Integration testing for endpoints
â”œâ”€â”€ E2E Tests: Playwright for user workflows
â””â”€â”€ GPS Mocking: Test location-based features

ğŸš€ Deployment Extensions
â”œâ”€â”€ Vercel Platform: Serverless deployment
â”œâ”€â”€ Environment Management: Development/Production configs
â””â”€â”€ Database Migrations: Automated via Supabase CLI
```

### Future Story Integration Points
```typescript
ğŸ“¸ Selfie Verification (Story 1.4)
â”œâ”€â”€ Extend: time_entries table with photo URLs
â”œâ”€â”€ Add: Camera capture components
â””â”€â”€ Integrate: Supabase Storage for photos

ğŸ“Š Material Tracking (Story 2.x)
â”œâ”€â”€ Add: material_usage, raw_materials tables
â”œâ”€â”€ Create: Inventory management features
â””â”€â”€ Link: Branch-specific material tracking

ğŸ’¸ Sales Reporting (Story 2.x)
â”œâ”€â”€ Add: sales_reports table
â”œâ”€â”€ Create: Daily sales entry forms  
â””â”€â”€ Generate: Branch/employee sales analytics
```

---

**Generated**: 2025-09-07 | **Project**: Employee Management System | **Version**: 1.0  
**Context**: Story 1.3 Branch Management & GPS Configuration Implementation

*This handbook serves as the primary navigation guide for AI agents and human developers working on the Employee Management System codebase.*